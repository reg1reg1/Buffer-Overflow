## Exploit Research: Level- Basic

The folder vuln exe contains the executables which we will try to exploit. These are basic .exes and the system we will run them on is **Windows XP, SP3**.
The attacker machine could be any Ubuntu/Debian Distro. If you want the payloads to spawn a meterpretershell instead of a simple shell-bind tcp or reverse tcp, go with the Kali distros which have metasploit pre-installed.

For understanding the exploitable dynamically you may use Ghidra (works on more advanced Win systems than XP, or less tedious to install atleast). I chose ImmunityDBG as it works well on the older XP systems and has sufficient features for debugging, for now.

The section here highlights the exploits covered under the course exploit research megaprimer and more. Some of the vuln exe listed here can be found in the vuln folder.

### Vanilla exploit-research.

I will add more steps here, as I learn more. So far most of the exploits in Win XP SP3 are simple and straightforward.
First step is to identify and discover a vulnerability, and this step might involve a lot of fuzzing or testing the different inputs for identifying buffer overflow. The stack growth is from high memory to low memory, and the buffer growth is in the opposite direction.

1. For the suspected input, submit a long input. This often must adhere to guidelines- If the input expects a URL, the long input must then begin with certain set of characters. A long string of characters is supplied to identify the offset getting written to the EIP. 
2. Once the EIP is overwritten, we know the padding as shown in the exploit code. We also identify restricted characters here.
3. Next comes the instruction which will contain some way to get to the return address of shellcode. Often, this can be the return of the shellcode. 
4. The return address could point to a NOP sled, or to the shellcode. There could be cases where the stack is not executable, in those cases various techniques exist such as "Return to libc" among others. There is one more technique called "JMP esp" aids in helping when we want no 00 or certain characters in the address, as the shellcode gets truncated. 
In "JMP ESP" technique we try to find the instruction string "JMP ESP" , which could be in dll's etc. Then after the initial buffer we place the address to this "JMP ESP" instruction. The JMP ESP helps eliminate the special characters present in address.
5. After the nopsled comes the payload of the exploit, which you can write on your own, or have msfvenom generate it to and have a handler listen to it. A good vanilla approach is to use a standard bind shell shellcode, and connect back using netcat, but you can always have a meterpreter payload.



### Exe-1: Server-Memcpy.exe:
Simple case of Memcpy exploitation. Memcpy is a bad boy. Memcpy takes stuff and puts them in bags which are bigger than the stuff, causing them to spill out from the bags onto other things. This is a vanilla buffer overflow exploit. The Memcpy buffer overflow exploit on windows is the easiest. No bad characters. No ASLR, No canaries. Life is simple, good and easy.


### Exe-2: Server-Strcpy.exe:
Strcpy is Memcpy's big brother. It does the same stupid stuff of not knowing the bag and the stuff size rule. But Strcpy does not take no bad chars like '00'. Strcpy exploit prevents us from the buffer exploit design we used in Memcpy, and forces us to remove the bad characters. Also, the more important thing is to understand how to identify bad characters that are not tolerated by the vulnerable executable. The technique is to feed the exploitables the series of characters from '\x00' to '\xff' and see if anyone of them gets truncated. Once they are , remove it and try again.

Here the problem is the return address of EIP has a bad char. So , we have to modify our exploitation approach, as our payload cannot have this anymore. When EIP executes the JMP ESP , EIP jumps to the next instruction on the stack (Which is where there is a NOP Sled) leading to the shellcode.  The Strcpy's filtering of characters , makes us use the exploit technique "JMP ESP"


### Exe-3: Minishare:
Minishare is a file sharing application that shares file by using a server on Minishare. The minishare 1.4.1 is vulnerable to a buffer overflow. Vulnerability analysis and identifying the vulnerability is whole another excercise. Here, we will exploit the known vulnerability, and the vulnerability lies in the url parsing of Minishare. Other than that, it is same as the Strcpy exploit and we use the "JMP ESP" technique once again.

Link: https://www.exploit-db.com/exploits/616


### Exe-4: Free-Sshd:

The exploit here lies in the key exchange. The initial payload contains input which is for satisfying the protocol of SSH handshake, and not related to the exploit. Here again, the "JMP ESP" technique is used for avoiding the special character truncation. The fundamental here is that the exploit needs the knowledge of the underlying vulnerable protocol which causes the change in the exploit code.

Link to vuln program: https://www.exploit-db.com/exploits/1787

### Exe-5: Memcpy-v1,v2 and 3

The Memcpyv1 and v2 are same as exe-1 which was included as a part of coursework which was completed earlier. The challenge is to use and filter out the bad characters and use the "JMP ESP" technique for removing the bad characters from the return address space.  There is one more catch with v3 however.
V3 is a case where the stack gets overwritten by an instruction after we have overflown the race condition.  To avoid the overwrite, we offset the stack by some amount say 2000 during the time we push our shellcode onto stack. When we do this we cause the overflow that happens after we store our goodies in the stack to be stored in the same place, but since we executed **"sub esp 2000"** , we make the overflow occur now 2000 bytes higher in the stack. (higher in stack implies lower memory, hence sub esp). Once we do this, we can execute the exploit.



### Exe-6: Microp

Microp is an mp3 player which was developed when winamp was popular. It had a buffer overflow exploit. The exploit here is a tad bit different. The playlist file is the area where the exploit occurs, so this is not a remote, but a local stack based exploit. To achieve the exploit,the victim downloads an infected playlist file onto system which can cause a buffer overflow when opened by microp.

Apart from the bad characters what makes this case unique, is that instead of the overflow filling up the stack eax
We cannot overwrite past the return address. The shellcode is present in memory, but eax is pointing to it, not the stack
So our shellcode is not present on the stack, but at address pointed by EAX.
Solution? Instead of **JMP ESP**, we can look for **JMP EAX** and **CALL EAX** instructions in the dll files. The user32.dll has a lot of jmp eax instruction. Both the instruction **JMP EAX** and **CALL EAX** would achieve the desired results, in the exploit, the JMP EAX instruction is used.



### Exe-7: BlazeDVD and Avisoft

DVD players with the exact same kind of buffer overflow in their playlist. The offsets are similar, and these are not tolerant to bad characters, and hence we need to use the **"JMP ESP"** technique for achieving the exploits. Like Microp , these are local stack-based exploits. The victim opens the exploit playlist and this causes a buffer overflow which can be used to pop open a shell. 



### Exe-8: FreeSSHD





### Exe-9: War-ftpd











